"use strict";angular.module("blocitoffApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider","$locationProvider",function(a,b){var c=routingConfig.accessLevels;a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",access:c.user}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",access:c.public}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",access:c.anon}).when("/list",{templateUrl:"views/list.html",controller:"ListCtrl",access:c.user}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$routeChangeStart",function(d,e){a.error=null,c.authorize(e.access)||b.path(c.isLoggedIn()?"/":"/login")})}]),angular.module("blocitoffApp").factory("Auth",["$http","$cookieStore",function(a,b){function c(a){angular.extend(f,a)}var d=routingConfig.accessLevels,e=routingConfig.userRoles,f=b.get("user")||{username:"",role:e.public};return b.remove("blocitoffUser"),{authorize:function(a,b){return void 0===b&&(b=f.role),void 0===a&&(a=d.public),a.bitMask&b.bitMask},isLoggedIn:function(a){return void 0===a&&(a=f),a.role.title===e.user.title||a.role.title===e.admin.title},signup:function(b,d,e){a.post("/signup",b).success(function(a){c(a),d()}).error(e)},login:function(b,d,e){a.post("/login",b).success(function(a){c(a),d()}).error(e)},logout:function(b,d){a.post("/logout").success(function(){c({username:"",role:e.public}),b()}).error(d)},accessLevels:d,userRoles:e,user:f}}]),angular.module("blocitoffApp").factory("Todo",["$http","$rootScope","Auth",function(a,b,c){return{createList:function(b,d,e){var f={username:c.user.username,listName:b};a.post("/newlist",f).success(function(){d()}).error(e)},removeList:function(b,d,e){var f={username:c.user.username,listId:b};a.post("/removeList",f).success(function(){d()}).error(e)},getListNames:function(d,e){a.post("/getlistnames",{username:c.user.username}).success(function(a){b.$broadcast("todo.listNamesUpdated",a)}).error(e)},getList:function(d,e){var f={username:c.user.username,listId:b.listId};a.post("/getlist",f).success(function(a){b.$broadcast("todo.listUpdated",a)}).error(e)},addListItem:function(b,d,e,f){var g={username:c.user.username,listId:b,text:d};a.post("/additem",g).success(function(){e()}).error(f)},removeListItem:function(b,d,e,f){var g={username:c.user.username,listId:b,itemId:d};a.post("/removeitem",g).success(function(){e()}).error(f)}}}]),angular.module("blocitoffApp").controller("MainCtrl",["$scope","$log","$location","$rootScope","Todo",function(a,b,c,d,e){e.getListNames(),a.$on("todo.listNamesUpdated",function(b,c){a.lists=c}),a.createList=function(b){e.createList(b,e.getListNames),a.newListName=""},a.removeList=function(a){e.removeList(a,e.getListNames)},a.openList=function(a){d.listId=a,c.path("/list")},a.$log=b}]),angular.module("blocitoffApp").controller("ListCtrl",["$scope","$log","$rootScope","Todo",function(a,b,c,d){a.listId=c.listId,d.getList(),a.$on("todo.listUpdated",function(b,c){a.list=c}),a.addListItem=function(b){d.addListItem(a.listId,b,d.getList),a.newListItem=""},a.removeListItem=function(b){d.removeListItem(a.listId,b,d.getList)}}]),angular.module("blocitoffApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("blocitoffApp").controller("LoginCtrl",["$rootScope","$scope","$location","$window","Auth",function(a,b,c,d,e){b.rememberme=!0,b.login=function(){e.login({username:b.username,password:b.password,rememberme:!0},function(){c.path("/")},function(b){a.error=b})},b.signup=function(){e.signup({username:b.username,password:b.password},function(){c.path("/")},function(b){a.error=b})},b.loginOauth=function(a){d.location.href="/auth/"+a}}]),angular.module("blocitoffApp").controller("NavCtrl",["$rootScope","$scope","$location","Auth",function(a,b,c,d){b.user=d.user,b.userRoles=d.userRoles,b.accessLevels=d.accessLevels,b.logout=function(){d.logout(function(){c.path("/login")},function(){a.error="Failed to logout"})}}]),angular.module("blocitoffApp").directive("timeRemaining",["dateFilter","$log",function(){function a(a,b){var c=(b-a)/1e3,d=Math.floor(c/86400);c-=86400*d;var e=Math.floor(c/3600)%24;c-=3600*e;var f=Math.floor(c/60)%60;c-=60*f;var g=Math.floor(c);return d+"D "+e+"H "+f+"M "+g+"S"}return function(b,c,d){function e(){var b=new Date;c.text(a(b,h))}function f(){setTimeout(function(){e(),f()},1e3)}var g=(d.timeRemaining,moment(d.itemCreated)),h=g.add("d",7);f()}}]);